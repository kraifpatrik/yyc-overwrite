# YYC Overwrite
> A simple command line tool that allows you to easily modify C++ files generated by YYC.

![License](https://img.shields.io/github/license/kraifpatrik/yyc-overwrite)

# Features
* Define local variables with native C++ types \[experimental\]
* Inject blocks of C++ code inbetween GML
* Overwrite entire GML by given C++ code
* Cleanup C++ to increase performance*

>\* The tool automatically removes code that keeps track of which line of code is being executed. This increases performance, but it also means that GameMaker won't tell you correct lines in error messages if an error occurs!

# How to use
1. Install [Python 3](https://www.python.org/downloads/).
2. Open your GameMaker Studio 2 project.
3. Remove all `gml_pragma("forceinline")` from your project, it causes automatical overwriting of all C++ files, disabling their modification!
4. Run the project using YYC.
5. Near the top of the Output console you will se a line like `"C:\ProgramData/GameMakerStudio2/Cache/runtimes\runtime-2.2.2.326/bin/Igor.exe"  -j=12 -options="C:\Users\kraif\AppData\Local\GameMakerStudio2\GMS2TEMP\build.bff"  -- Windows Run`. The options path is required by the tool.
6. Run the tool from the command line using
```
python yyc-overwite.py
```
7. It will ask for the path to the build.bff file. You can just press enter to leave the default value.
8. The tool now prints some info about the project, including "Target directory", which is the YYC cache directory where you can find the original C++ files.
9. In GM, you can now write code that will be used to modify the generated functions - see examples.
10. Run the tool again using the same command as in `3.`, it will now modify the C++ files.

# Examples
## Native C++ types for local variables
1. Put following macro definitions somewhere in you project.
```
#macro const ;
#macro static ;
#macro bool_t var
#macro char_t var
#macro int_t var
#macro longlong_t var
#macro float_t var
#macro double_t var
```
2. You can now define typed local variables using the macros, eg:
```cpp
/// @func get_counter()
static int_t _counter = 0;
return _counter++;

/// @desc Create event
show_debug_message(get_counter()); // => 0
show_debug_message(get_counter()); // => 1
show_debug_message(get_counter()); // => 2
```
3. Run YYC Overwrite to inject the types. Injecting types is idempotent - can be done multiple times without cleaning cache or running the project again. 

**Please note that this is an experimental feature and the resulting code may be incorrect in some cases. If you do find such case, please let me know.**

## Custom C++
If a comment block starts with `cpp-overwrite`, the entire body of the generated function will be replaced with the content of that block. Overwriting is idempotent - can be done multiple times without cleaning cache or running the project again.

```js
/*cpp-overwrite
for (size_t i = 0; i < 10; ++i)
{
  YYGML_show_debug_message("It works! :)");
}
*/
for (var i = 0; i < 10; ++i)
{
  show_debug_message("It doesn't work! :(");
}
```

If a comment block starts with `cpp` only, its content will be injected at given position.

```js
/*cpp for (size_t i = 0; i < 10; ++i) { */
  show_debug_message("This should be printed 10 times.");
/*cpp } */
```

Injecting is currently not idempotent - you will have to clean cache or run the project before injecting code again!